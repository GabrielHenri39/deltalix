{% extends "base/base.html" %}
{% load static %}

{% block 'title' %}Detalhes{% endblock 'title' %}

{% block 'head' %}
<link rel="stylesheet" href="{% static 'auteticacao/css/style.css' %}">
 <link rel="stylesheet" href="{% static 'services/css/service.css' %}">
{% endblock 'head' %}

{% block nav %}
  {% include "partials/navbard.html" %}
{% endblock nav %}

{% block content %}
<div class="container mt-5">
    
    {% if messages %}
            <div class="mb-3">
            {% for message in messages %}
                <div class="alert {{ message.tags }} text-center">
                {{ message }}
                </div>
            {% endfor %}
            </div>
        {% endif %}
             
        
    <h2>Detalhes do Serviço</h2>
    <div class="card">
        <div class="card-body">
            <h5 class="card-title   mb-3">ID do serviço: {{ servico.id }}</h5>
            <p class="card-text"><strong>Cliente:</strong> {{ servico.nome}}</p>
            <p class="card-text"><strong>Email:</strong> {{ servico.email }}</p>
            <p class="card-text"><strong>Telefone:</strong> {{ servico.telefone }}</p>
            <p><strong>Protocolo:</strong> {{servico.protocolo}}</p>
            
            <p><strong>endereço:</strong> 
            {{servico.rua}} {{servico.numero}} {{servico.cidade}}</p>
            <p><strong>Complemento:</strong>{% if servico.cmplemento %}
                    {{ servico.cmplemento }}
                {% else %}
                    <span class="text-muted">Sem cmplemento disponível.</span>
                {% endif %}
            </p></p>
            <p><strong>CEP:</strong> {{servico.cep}}</p>
            
            <p class="card-text"><strong>Categoria:</strong> 
                {% for categoria in servico.categoria.all %}
                    <span class="badge bg-success">{{ categoria.nome }}</span>
                {% empty %}
                    <span class="text-muted">Sem categorias.</span>
                {% endfor %}
            </p>

           
            <p><strong>Descrição:</strong> 
                {% if servico.descricao %}
                    {{ servico.descricao }}
                {% else %}
                    <span class="text-muted">Sem descrição disponível.</span>
                {% endif %}
            </p>

            <p class="card-text"><strong>Status:</strong> {{ servico.get_status_display }}</p>
            <p class="card-text"><strong>Data de Criação:</strong> {{ servico.data_criacao|date:"d/m/Y H:i" }}</p>
            <p class="card-text"><strong>Data de Atualização:</strong> {{ servico.data_atualizacao|date:"d/m/Y H:i" }}</p>
            <form method="POST" class="mt-4">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="status" class="form-label"><strong>Atualizar Status:</strong></label>
                    <select class="form-select" id="status" name="status">
                        {% for key, value in servico.STATUS_CHOICES %}
                            <option value="{{ key }}" {% if servico.status == key %}selected{% endif %}>{{ value }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Atualizar Status</button>
            </form> 
            <hr>
            {% include 'partials/anexos.html' %}
            <br>
            <form action="{% url 'anexar_arquivo' servico.id %}" method="post" enctype='multipart/form-data' >
                {% csrf_token %}
                <div class="mb-3">
                    <label for="arquivo" class="form-label"><strong>Enviar Anexo:</strong></label>
                    <input class="form-control" type="file" id="arquivo" name="arquivo" required>
                </div>
                <button type="submit" class="btn btn-secondary">Enviar Anexo</button>
            </form>
            
        </div>
    </div>
</div>
<!-- Importa o JS separado -->

{% endblock %}
